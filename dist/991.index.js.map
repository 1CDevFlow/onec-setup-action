{"version":3,"file":"991.index.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAIA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAtFA","sources":[".././src/tools/edt.ts"],"sourcesContent":["import { OnecTool } from './onecTool'\nimport * as core from '@actions/core'\nimport { exec } from '@actions/exec'\nimport * as glob from '@actions/glob'\nimport * as tc from '@actions/tool-cache'\nimport { downloadRelease } from '../onegetjs'\n\nexport class EDT extends OnecTool {\n  INSTALLED_CACHE_PRIMARY_KEY = 'edt'\n  version: string\n  cache_: string[]\n  platform: string\n  constructor(version: string, platform: string) {\n    super()\n    this.version = version\n    this.platform = platform\n    this.cache_ = this.getCacheDirs()\n  }\n  async download(): Promise<void> {\n    const onegetPlatform = this.getPlatformType()\n\n    await downloadRelease(\n      {\n        project: 'DevelopmentTools10',\n        version: this.version,\n        osName: onegetPlatform,\n        offline: true\n      },\n      `/tmp/${this.INSTALLER_CACHE_PRIMARY_KEY}`,\n      true\n    )\n  }\n\n  async install(): Promise<void> {\n    let installerPattern\n\n    if (this.isWindows()) {\n      installerPattern = '1ce-installer-cli.exe'\n    } else {\n      installerPattern = '1ce-installer-cli'\n    }\n\n    if (this.isWindows()) {\n      const pattern = `/tmp/${this.INSTALLER_CACHE_PRIMARY_KEY}/**/1c_edt_distr_offline*.zip`\n      core.info(pattern)\n      const globber = await glob.create(pattern)\n      for await (const file of globber.globGenerator()) {\n        await tc.extractZip(file)\n      }\n    }\n    const patterns = [\n      `/tmp/${this.INSTALLER_CACHE_PRIMARY_KEY}/**/${installerPattern}`\n    ]\n    const globber = await glob.create(patterns.join('\\n'))\n    const files = await globber.glob()\n\n    core.info(`finded ${files}`)\n\n    const install_arg = [\n      'install',\n      '--ignore-hardware-checks',\n      '--ignore-signature-warnings',\n      '--overwrite'\n    ]\n\n    if (this.isLinux()) {\n      await exec('sudo', [files[0], ...install_arg])\n    } else if (this.isWindows()) {\n      await exec(files[0], install_arg)\n    } else {\n      core.setFailed(`Unrecognized os${this.platform}`)\n    }\n  }\n\n  getCacheDirs(): string[] {\n    if (this.isWindows()) {\n      return ['C:/Program Files/1C', 'C:/ProgramData/1C/1CE/ring-commands.cfg']\n    } else if (this.isLinux()) {\n      return ['/opt/1C', '/etc/1C/1CE/ring-commands.cfg']\n    } else if (this.isMac()) {\n      return ['/Applications/1C']\n    } else {\n      throw new Error('Not supported on this OS type')\n    }\n  }\n\n  getRunFileNames(): string[] {\n    if (this.isWindows()) {\n      return ['ring.bat', '1cedtcli.bat']\n    } else {\n      return ['ring', '1cedtcli.sh']\n    }\n  }\n}\n"],"names":[],"sourceRoot":""}